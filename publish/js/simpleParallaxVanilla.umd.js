!function(t,e){"object"==typeof exports&&typeof module<"u"?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=typeof globalThis<"u"?globalThis:t||self).SimpleParallax=e()}(this,(function(){"use strict";const t=t=>NodeList.prototype.isPrototypeOf(t)||HTMLCollection.prototype.isPrototypeOf(t)?Array.from(t):"string"==typeof t||t instanceof String?document.querySelectorAll(t):[t];const e=new class{constructor(){this.positions={top:0,bottom:0,height:0}}setViewportTop(t){return this.positions.top=t?t.scrollTop:window.pageYOffset,this.positions}setViewportBottom(){return this.positions.bottom=this.positions.top+this.positions.height,this.positions}setViewportAll(t){return this.positions.top=t?t.scrollTop:window.pageYOffset,this.positions.height=t?t.clientHeight:document.documentElement.clientHeight,this.positions.bottom=this.positions.top+this.positions.height,this.positions}},s=(()=>{const t="transform webkitTransform mozTransform oTransform msTransform".split(" ");let e,s=0;for(;void 0===e;)e=void 0!==document.createElement("div").style[t[s]]?t[s]:void 0,s+=1;return e})();class i{constructor(t,e){var s;this.element=t,this.elementContainer=t,this.settings=e,this.isVisible=!0,this.isInit=!1,this.oldTranslateValue=-1,this.init=this.init.bind(this),this.customWrapper=this.settings.customWrapper&&this.element.closest(this.settings.customWrapper)?this.element.closest(this.settings.customWrapper):null,"img"!==(s=t).tagName.toLowerCase()&&"picture"!==s.tagName.toLowerCase()||s&&s.complete&&!(typeof s.naturalWidth<"u"&&0===s.naturalWidth)?this.init():this.element.addEventListener("load",(()=>{setTimeout((()=>{this.init(!0)}),50)}))}init(t){this.isInit||(t&&(this.rangeMax=null),!this.element.closest(".simpleParallax")&&(!1===this.settings.overflow&&this.wrapElement(this.element),this.setTransformCSS(),this.getElementOffset(),this.intersectionObserver(),this.getTranslateValue(),this.animate(),this.settings.delay>0?setTimeout((()=>{this.setTransitionCSS(),this.elementContainer.classList.add("simple-parallax-initialized")}),10):this.elementContainer.classList.add("simple-parallax-initialized"),this.isInit=!0))}wrapElement(){const t=this.element.closest("picture")||this.element;let e=this.customWrapper||document.createElement("div");e.classList.add("simpleParallax"),e.style.overflow="hidden",this.customWrapper||(t.parentNode.insertBefore(e,t),e.appendChild(t)),this.elementContainer=e}unWrapElement(){const t=this.elementContainer;this.customWrapper?(t.classList.remove("simpleParallax"),t.style.overflow=""):t.replaceWith(...t.childNodes)}setTransformCSS(){!1===this.settings.overflow&&(this.element.style[s]=`scale(${this.settings.scale})`),this.element.style.willChange="transform"}setTransitionCSS(){this.element.style.transition=`transform ${this.settings.delay}s ${this.settings.transition}`}unSetStyle(){this.element.style.willChange="",this.element.style[s]="",this.element.style.transition=""}getElementOffset(){const t=this.elementContainer.getBoundingClientRect();if(this.elementHeight=t.height,this.elementTop=t.top+e.positions.top,this.settings.customContainer){const s=this.settings.customContainer.getBoundingClientRect();this.elementTop=t.top-s.top+e.positions.top}this.elementBottom=this.elementHeight+this.elementTop}buildThresholdList(){const t=[];for(let e=1;e<=this.elementHeight;e++){const s=e/this.elementHeight;t.push(s)}return t}intersectionObserver(){const t={root:null,threshold:this.buildThresholdList()};this.observer=new IntersectionObserver(this.intersectionObserverCallback.bind(this),t),this.observer.observe(this.element)}intersectionObserverCallback(t){t.forEach((t=>{t.isIntersecting?this.isVisible=!0:this.isVisible=!1}))}checkIfVisible(){return this.elementBottom>e.positions.top&&this.elementTop<e.positions.bottom}getRangeMax(){const t=this.element.clientHeight;this.rangeMax=t*this.settings.scale-t}getTranslateValue(){let t=((e.positions.bottom-this.elementTop)/((e.positions.height+this.elementHeight)/100)).toFixed(1);return t=Math.min(100,Math.max(0,t)),0!==this.settings.maxTransition&&t>this.settings.maxTransition&&(t=this.settings.maxTransition),this.oldPercentage!==t&&(this.rangeMax||this.getRangeMax(),this.translateValue=(t/100*this.rangeMax-this.rangeMax/2).toFixed(0),this.oldTranslateValue!==this.translateValue)&&(this.oldPercentage=t,this.oldTranslateValue=this.translateValue,!0)}animate(){let t,e=0,i=0;(this.settings.orientation.includes("left")||this.settings.orientation.includes("right"))&&(i=`${this.settings.orientation.includes("left")?-1*this.translateValue:this.translateValue}px`),(this.settings.orientation.includes("up")||this.settings.orientation.includes("down"))&&(e=`${this.settings.orientation.includes("up")?-1*this.translateValue:this.translateValue}px`),t=!1===this.settings.overflow?`translate3d(${i}, ${e}, 0) scale(${this.settings.scale})`:`translate3d(${i}, ${e}, 0)`,this.element.style[s]=t}}let n,o,r=!1,a=[];return class{constructor(e,s){e&&Element.prototype.closest&&"IntersectionObserver"in window&&(this.elements=t(e),this.defaults={delay:0,orientation:"up",scale:1.3,overflow:!1,transition:"cubic-bezier(0,0,0,1)",customContainer:"",customWrapper:"",maxTransition:0},this.settings=Object.assign(this.defaults,s),this.settings.customContainer&&([this.customContainer]=t(this.settings.customContainer)),this.lastPosition=-1,this.resizeIsDone=this.resizeIsDone.bind(this),this.refresh=this.refresh.bind(this),this.proceedRequestAnimationFrame=this.proceedRequestAnimationFrame.bind(this),this.init())}init(){e.setViewportAll(this.customContainer),a=[...this.elements.map((t=>new i(t,this.settings))),...a],r||(this.proceedRequestAnimationFrame(),window.addEventListener("resize",this.resizeIsDone),r=!0)}resizeIsDone(){clearTimeout(o),o=setTimeout(this.refresh,200)}proceedRequestAnimationFrame(){e.setViewportTop(this.customContainer),this.lastPosition!==e.positions.top?(e.setViewportBottom(),a.forEach((t=>{this.proceedElement(t)})),n=window.requestAnimationFrame(this.proceedRequestAnimationFrame),this.lastPosition=e.positions.top):n=window.requestAnimationFrame(this.proceedRequestAnimationFrame)}proceedElement(t){let e=!1;e=this.customContainer?t.checkIfVisible():t.isVisible,e&&t.getTranslateValue()&&t.animate()}refresh(){e.setViewportAll(this.customContainer),a.forEach((t=>{t.getElementOffset(),t.getRangeMax()})),this.lastPosition=-1}destroy(){const t=[];a=a.filter((e=>this.elements.includes(e.element)?(t.push(e),!1):e)),t.forEach((t=>{t.unSetStyle(),!1===this.settings.overflow&&t.unWrapElement()})),a.length||(window.cancelAnimationFrame(n),window.removeEventListener("resize",this.refresh),r=!1)}}}));